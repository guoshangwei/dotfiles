#!/usr/bin/env ruby

require "fileutils"
require "pathname"
include FileUtils::Verbose

OS = RUBY_PLATFORM =~ /darwin/ ? :osx : :linux
ROOT = Pathname.new(__FILE__).parent.expand_path
DOTFILES_HOME = ROOT/"home"
HOME = Pathname.new(Dir.home)
BREW_PREFIX = Pathname.new(`brew --prefix`.chomp)

def system(*args)
  puts args
  super
end

def link_files(src_dir, dst_dir)
  mkdir_p dst_dir unless dst_dir.directory?
  src_dir.children.each do |file|
    next if file.directory?
    puts "#{file}->#{dst_dir}"
    #ln_sf file, dst_dir
  end
end

## Install oh-my-zsh
unless (HOME/".oh-my-zsh").exist?
  system "curl -L http://install.ohmyz.sh | sh"
end

## Install tmux-plugins
unless (HOME/".tmux/plugins/tpm").exist?
  system "git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm"
end

# Link file
link_files(DOTFILES_HOME, HOME)
link_files(DOTFILES_HOME/".config", HOME/".config")
link_files(DOTFILES_HOME/".matplotlib", HOME/".matplotlib")
link_files(DOTFILES_HOME/".oh-my-zsh/custom", HOME/".oh-my-zsh/custom")
link_files(DOTFILES_HOME/".ssh", HOME/".ssh") if OS == :osx
system "lesskey"
ln_sf BREW_PREFIX/"Library/Contributions/brew_zsh_completion.zsh", BREW_PREFIX/"share/zsh/site-functions/_brew"
